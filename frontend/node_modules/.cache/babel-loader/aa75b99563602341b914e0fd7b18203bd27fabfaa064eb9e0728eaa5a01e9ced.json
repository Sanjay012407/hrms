{"ast":null,"code":"// src/context/AuthContext.js\nimport React,{createContext,useContext,useState,useEffect}from\"react\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error(\"useAuth must be used within an AuthProvider\");}return context;};const getApiUrl=()=>{var _process$env$REACT_AP;// In development, use localhost URL\nif(process.env.NODE_ENV==='development'&&process.env.REACT_APP_API_URL){return process.env.REACT_APP_API_URL;}// In production or when API_BASE_URL is relative, use relative path\nif((_process$env$REACT_AP=process.env.REACT_APP_API_BASE_URL)!==null&&_process$env$REACT_AP!==void 0&&_process$env$REACT_AP.startsWith('/')){return'';}// Fallback to localhost for development\nreturn process.env.REACT_APP_API_URL||'http://localhost:5003';};const API_BASE_URL=\"\".concat(getApiUrl());// Configure axios to include credentials (cookies) with requests\naxios.defaults.withCredentials=true;export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Check for existing session on app start\nuseEffect(()=>{validateSession();},[]);const validateSession=async()=>{try{console.log('Validating session...');const response=await axios.get(\"\".concat(API_BASE_URL,\"/auth/validate-session\"),{withCredentials:true,timeout:10000// 10-second timeout\n});console.log('Session validation response:',response.data);if(response.data.valid&&response.data.user){setUser(response.data.user);setIsAuthenticated(true);localStorage.setItem('user',JSON.stringify(response.data.user));console.log('Session validated successfully');return true;}else{console.log('Session validation failed - invalid response');handleInvalidSession();return false;}}catch(error){var _error$response;console.error('Session validation error:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status,error.message);// If it's a network error, try to use cached data temporarily\nif(error.code==='NETWORK_ERROR'||error.code==='ECONNABORTED'){const cachedUser=localStorage.getItem('user');if(cachedUser){console.log('Using cached user data due to network error');setUser(JSON.parse(cachedUser));setIsAuthenticated(true);return true;}}handleInvalidSession();return false;}};const login=async function(email,password){let rememberMe=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;setLoading(true);setError(null);try{const response=await axios.post(\"\".concat(API_BASE_URL,\"/api/auth/login\"),{email,password,rememberMe});const{token,user:userData}=response.data;// Store token in localStorage for API compatibility\nif(token){localStorage.setItem(\"authToken\",token);}localStorage.setItem(\"userData\",JSON.stringify(userData));// Update state - session is automatically handled by cookies\nsetUser(userData);setIsAuthenticated(true);return{success:true};}catch(err){var _err$response,_err$response$data;const errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"Login failed\";setError(errorMessage);return{success:false,error:errorMessage};}finally{setLoading(false);}};const signup=async userData=>{setLoading(true);setError(null);try{const response=await axios.post(\"\".concat(API_BASE_URL,\"/api/auth/signup\"),userData);return{success:true,message:\"Account created successfully\"};}catch(err){var _err$response2,_err$response2$data;const errorMessage=((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||\"Signup failed\";setError(errorMessage);return{success:false,error:errorMessage};}finally{setLoading(false);}};const logout=async()=>{setLoading(true);try{// Call backend logout endpoint to destroy session\nawait axios.post(\"\".concat(API_BASE_URL,\"/auth/logout\"));}catch(err){console.error(\"Logout error:\",err);}finally{// Clear local state and storage regardless of API call result\nlocalStorage.removeItem(\"authToken\");localStorage.removeItem(\"userData\");setUser(null);setIsAuthenticated(false);setError(null);setLoading(false);}};const value={user,isAuthenticated,loading,error,login,signup,logout,validateSession};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","jsx","_jsx","AuthContext","useAuth","context","Error","getApiUrl","_process$env$REACT_AP","process","env","NODE_ENV","REACT_APP_API_URL","REACT_APP_API_BASE_URL","startsWith","API_BASE_URL","concat","defaults","withCredentials","AuthProvider","_ref","children","user","setUser","isAuthenticated","setIsAuthenticated","loading","setLoading","error","setError","validateSession","console","log","response","get","timeout","data","valid","localStorage","setItem","JSON","stringify","handleInvalidSession","_error$response","status","message","code","cachedUser","getItem","parse","login","email","password","rememberMe","arguments","length","undefined","post","token","userData","success","err","_err$response","_err$response$data","errorMessage","signup","_err$response2","_err$response2$data","logout","removeItem","value","Provider"],"sources":["/root/hrms/frontend/src/context/AuthContext.js"],"sourcesContent":["// src/context/AuthContext.js\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n};\n\nconst getApiUrl = () => {\n  // In development, use localhost URL\n  if (process.env.NODE_ENV === 'development' && process.env.REACT_APP_API_URL) {\n    return process.env.REACT_APP_API_URL;\n  }\n  // In production or when API_BASE_URL is relative, use relative path\n  if (process.env.REACT_APP_API_BASE_URL?.startsWith('/')) {\n    return '';\n  }\n  // Fallback to localhost for development\n  return process.env.REACT_APP_API_URL || 'http://localhost:5003';\n};\n\nconst API_BASE_URL = `${getApiUrl()}`;\n\n// Configure axios to include credentials (cookies) with requests\naxios.defaults.withCredentials = true;\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Check for existing session on app start\n  useEffect(() => {\n    validateSession();\n  }, []);\n\n  const validateSession = async () => {\n    try {\n      console.log('Validating session...');\n\n      const response = await axios.get(`${API_BASE_URL}/auth/validate-session`, {\n        withCredentials: true,\n        timeout: 10000 // 10-second timeout\n      });\n\n      console.log('Session validation response:', response.data);\n\n      if (response.data.valid && response.data.user) {\n        setUser(response.data.user);\n        setIsAuthenticated(true);\n        localStorage.setItem('user', JSON.stringify(response.data.user));\n        console.log('Session validated successfully');\n        return true;\n      } else {\n        console.log('Session validation failed - invalid response');\n        handleInvalidSession();\n        return false;\n      }\n    } catch (error) {\n      console.error('Session validation error:', error.response?.status, error.message);\n\n      // If it's a network error, try to use cached data temporarily\n      if (error.code === 'NETWORK_ERROR' || error.code === 'ECONNABORTED') {\n        const cachedUser = localStorage.getItem('user');\n        if (cachedUser) {\n          console.log('Using cached user data due to network error');\n          setUser(JSON.parse(cachedUser));\n          setIsAuthenticated(true);\n          return true;\n        }\n      }\n\n      handleInvalidSession();\n      return false;\n    }\n  };\n\n  const login = async (email, password, rememberMe = false) => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/login`, {\n        email,\n        password,\n        rememberMe\n      });\n      \n      const { token, user: userData } = response.data;\n      \n      // Store token in localStorage for API compatibility\n      if (token) {\n        localStorage.setItem(\"authToken\", token);\n      }\n      localStorage.setItem(\"userData\", JSON.stringify(userData));\n      \n      // Update state - session is automatically handled by cookies\n      setUser(userData);\n      setIsAuthenticated(true);\n      \n      return { success: true };\n    } catch (err) {\n      const errorMessage = err.response?.data?.message || \"Login failed\";\n      setError(errorMessage);\n      return { success: false, error: errorMessage };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signup = async (userData) => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await axios.post(`${API_BASE_URL}/api/auth/signup`, userData);\n      \n      return { success: true, message: \"Account created successfully\" };\n    } catch (err) {\n      const errorMessage = err.response?.data?.message || \"Signup failed\";\n      setError(errorMessage);\n      return { success: false, error: errorMessage };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const logout = async () => {\n    setLoading(true);\n    try {\n      // Call backend logout endpoint to destroy session\n      await axios.post(`${API_BASE_URL}/auth/logout`);\n    } catch (err) {\n      console.error(\"Logout error:\", err);\n    } finally {\n      // Clear local state and storage regardless of API call result\n      localStorage.removeItem(\"authToken\");\n      localStorage.removeItem(\"userData\");\n      setUser(null);\n      setIsAuthenticated(false);\n      setError(null);\n      setLoading(false);\n    }\n  };\n\n  const value = {\n    user,\n    isAuthenticated,\n    loading,\n    error,\n    login,\n    signup,\n    logout,\n    validateSession\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}